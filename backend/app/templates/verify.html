{% extends "base.html" %}
{% block title %}Verify Certificate{% endblock %}
{% block content %}
<div class="max-w-3xl mx-auto bg-white border rounded-xl shadow-sm p-8">
  {% if not found %}
    <h2 class="text-2xl font-semibold text-red-600 mb-4">Certificate not found</h2>
    <p class="text-slate-600">No certificate with ID <strong>{{ cert_id }}</strong> exists in the registry.</p>
  {% else %}
    <div class="flex items-center justify-between mb-6">
      <h1 class="text-3xl font-semibold">Certificate Verification</h1>
      <span class="px-3 py-1 rounded-full text-sm {{ 'bg-green-100 text-green-600' if signature_valid and not cert.revoked else 'bg-red-100 text-red-600' }}">
        {{ 'Authentic' if signature_valid and not cert.revoked else 'Revoked / Invalid' }}
      </span>
    </div>
    <dl class="grid grid-cols-2 gap-4 mb-6">
      <div>
        <dt class="text-sm text-slate-500">Recipient</dt>
        <dd class="text-lg font-semibold">{{ cert.name }}</dd>
      </div>
      <div>
        <dt class="text-sm text-slate-500">Cohort</dt>
        <dd class="text-lg font-semibold">{{ cert.cohort }}</dd>
      </div>
      <div>
        <dt class="text-sm text-slate-500">Issued at</dt>
        <dd>{{ cert.issued_at }}</dd>
      </div>
      <div>
        <dt class="text-sm text-slate-500">Certificate ID</dt>
        <dd class="font-mono text-sm">{{ cert.id }}</dd>
      </div>
    </dl>
    <div class="border rounded-lg p-4 mb-6">
      <h3 class="font-semibold mb-2">Signature proof (Ed25519)</h3>
      <p class="font-mono text-xs overflow-auto break-all">{{ cert.signature }}</p>
      <p class="mt-2 text-sm {{ 'text-green-600' if signature_valid else 'text-red-600' }}">
        {{ 'Signature matches public key.' if signature_valid else 'Signature verification failed.' }}
      </p>
    </div>

    <div class="border rounded-lg p-4 mb-6">
      <h3 class="font-semibold mb-2">Bitcoin timestamp (OpenTimestamps)</h3>
      {% if ots.status == 'verified' %}
        <p class="text-green-600 text-sm">Proof verified on Bitcoin.</p>
      {% else %}
        <p class="text-sm text-slate-600">Status: {{ ots.status or 'pending' }}</p>
        {% if ots.error %}<p class="text-sm text-red-600">{{ ots.error }}</p>{% endif %}
      {% endif %}
      {% if cert.ots_proof_path %}
        <a href="{{ url_for('web.download_proof', cert_id=cert.id) }}" class="text-orange-500 text-sm underline">Download .ots proof</a>
      {% endif %}
    </div>

    {% if cert.revoked %}
      <div class="border border-red-200 bg-red-50 rounded-lg p-4 mb-6">
        <h3 class="font-semibold text-red-700 mb-1">Certificate revoked</h3>
        <p class="text-sm text-red-700">Revoked at {{ cert.revoked_at }}. Reason: {{ cert.revocation_reason }}</p>
      </div>
    {% endif %}

    <div class="flex flex-wrap gap-3">
      <a href="{{ cert.linkedin_share_url }}" target="_blank" class="px-4 py-2 bg-blue-600 text-white rounded-md text-sm font-semibold">Share on LinkedIn</a>
      <a href="/verify-identity/{{ cert.id }}" class="px-4 py-2 bg-orange-500 text-white rounded-md text-sm font-semibold">Verify Identity</a>
      <a href="{{ cert.verify_url }}" class="px-4 py-2 border border-slate-300 rounded-md text-sm font-semibold">Copy verification URL</a>
    </div>
  {% endif %}
</div>
{% endblock %}

